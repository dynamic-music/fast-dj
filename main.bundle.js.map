{"version":3,"sources":["/Users/lucast/code/fast-dj/src/$_gendir lazy","/Users/lucast/code/fast-dj/src/app/app.component.css","/Users/lucast/code/fast-dj/src/app/app.component.html","/Users/lucast/code/fast-dj/src/app/app.component.ts","/Users/lucast/code/fast-dj/src/app/app.module.ts","/Users/lucast/code/fast-dj/src/app/services/feature-extraction/feature-extraction.service.ts","/Users/lucast/code/fast-dj/src/environments/environment.ts","/Users/lucast/code/fast-dj/src/main.ts","/Users/lucast/code/fast-dj/node_modules/n3/lib ^\\.\\/N3.*$","util (ignored)","vertx (ignored)"],"names":[],"mappings":"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","file":"main.bundle.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\treturn new Promise(function(resolve, reject) { reject(new Error(\"Cannot find module '\" + req + \"'.\")); });\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"../../../../../src/$$_gendir lazy recursive\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/lucast/code/fast-dj/src/$$_gendir lazy\n// module id = ../../../../../src/$$_gendir lazy recursive\n// module chunks = main","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".custom-component-drop-zone {\\n  width: 100%;\\n  height: 100%;\\n}\", \"\"]);\n\n// exports\n\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = module.exports.toString();\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/lucast/code/fast-dj/src/app/app.component.css\n// module id = ../../../../../src/app/app.component.css\n// module chunks = main","module.exports = \"<!--The content below is only a placeholder and can be replaced.-->\\n<div\\n  ng2FileDrop\\n  class=\\\"custom-component-drop-zone\\\"\\n  (ng2FileDropFileAccepted)=\\\"dragFileAccepted($event)\\\"\\n>\\n</div>\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/lucast/code/fast-dj/src/app/app.component.html\n// module id = ../../../../../src/app/app.component.html\n// module chunks = main","import * as _ from 'lodash';\nimport { Component } from '@angular/core';\nimport { Ng2FileDropAcceptedFile } from 'ng2-file-drop';\nimport { DymoGenerator, DymoTemplates, MixGenerator, DymoManager, GlobalVars, uris } from 'dymo-core';\nimport {\n  FeatureExtractionService\n} from './services/feature-extraction/feature-extraction.service';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent {\n  title = 'app';\n  private dymoGen: DymoGenerator;\n  private mixGen: MixGenerator;\n  private manager: DymoManager;\n  private isPlaying = false;\n  private previousDymos = [];\n\n  constructor(private extractionService: FeatureExtractionService) {\n    GlobalVars.LOGGING_ON = true;\n    this.manager = new DymoManager();\n    this.manager.init('https://semantic-player.github.io/dymo-core/ontologies/')\n      .then(() => {\n        let store = this.manager.getStore();\n        this.dymoGen = new DymoGenerator(store);\n        this.mixGen = new MixGenerator(this.dymoGen);\n      });\n    this.manager.getPlayingDymoUris()\n      .subscribe(updatedDymos => {\n        if (_.difference(updatedDymos, this.previousDymos).length > 0) {\n          console.log(updatedDymos);\n        }\n        this.previousDymos = updatedDymos;\n      });\n  }\n\n  private dragFileAccepted(acceptedFile: Ng2FileDropAcceptedFile) {\n    const url = URL.createObjectURL(acceptedFile.file);\n    this.manager.getAudioBank().loadBuffer(url)\n      .then(buffer => this.extractionService.extractBeats(buffer))\n      .then(beats => DymoTemplates.createAnnotatedBarAndBeatDymo2(this.dymoGen, url, beats))\n      .then(newDymo => this.manager.loadFromStore(newDymo)\n        .then(() => this.mixGen.transitionToSong(newDymo, 1)))\n      .then(mixDymo => this.keepOnPlaying(mixDymo));\n  }\n\n  private keepOnPlaying(dymoUri: string) {\n    if (!this.isPlaying) {\n      this.isPlaying = true;\n      this.manager.startPlayingUri(dymoUri);\n    }\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// /Users/lucast/code/fast-dj/src/app/app.component.ts","import { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\nimport { AppComponent } from './app.component';\nimport { Ng2FileDropModule } from 'ng2-file-drop';\nimport {\n  FeatureExtractionService\n} from './services/feature-extraction/feature-extraction.service';\n\n@NgModule({\n  declarations: [\n    AppComponent\n  ],\n  imports: [\n    BrowserModule,\n    Ng2FileDropModule\n  ],\n  providers: [\n    FeatureExtractionService\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {}\n\n\n\n// WEBPACK FOOTER //\n// /Users/lucast/code/fast-dj/src/app/app.module.ts","import { Injectable } from '@angular/core';\nimport {\n  OneShotExtractionClient,\n  OneShotExtractionRequest as Request,\n  OneShotExtractionResponse as Response,\n  OneShotExtractionScheme\n} from 'piper-js/one-shot';\nimport { FeatureList } from 'piper-js/core';\nimport { toSeconds } from 'piper-js/time';\nimport createQmWorker from '@extractors/qm';\n\n// this spawns a web worker, which we only want to do once\n// so we instantiate \nconst qmWorker = createQmWorker();\n\nexport interface Value<T> {\n  value: T;\n}\nexport interface Beat {\n  time: Value<number>;\n  label: Value<string>;\n}\n\ninterface AudioData {\n  channels: Float32Array[];\n  sampleRate: number;\n  duration: number;\n}\n\nfunction bufferToAudioData(buffer: AudioBuffer): AudioData {\n  const nChannels = buffer.numberOfChannels;\n  const channels = new Array<Float32Array>(nChannels);\n  for (let i = 0; i < nChannels; ++i) {\n    channels[i] = buffer.getChannelData(i);\n  }\n  return {\n    channels,\n    sampleRate: buffer.sampleRate,\n    duration: buffer.duration\n  };\n}\n\n@Injectable()\nexport class FeatureExtractionService {\n  private client: OneShotExtractionClient;\n\n  constructor() {\n    this.client = new OneShotExtractionClient(\n      qmWorker,\n      OneShotExtractionScheme.REMOTE\n    );\n  }\n\n  extract(request: Request): Promise<Response> {\n    return this.client.collect(request);\n  }\n\n  extractBeats(buffer: AudioBuffer): Promise<Beat[]> {\n    const {channels, sampleRate} = bufferToAudioData(buffer);\n    return this.extract({\n      audioData: channels,\n      audioFormat: {\n        sampleRate,\n        channelCount: channels.length\n      },\n      key: 'qm-vamp-plugins:qm-barbeattracker',\n      outputId: 'beats'\n    }).then(mapFeaturesToBeats);\n  }\n}\n\nfunction mapFeaturesToBeats(response: Response): Beat[] {\n  // TODO ought to actually validate the shape / type\n  const featureData: FeatureList = response.features.collected as FeatureList;\n  return featureData.map(feature => ({\n    time: {value: toSeconds(feature.timestamp)},\n    label: {value: feature.label}\n  }));\n}\n\n\n// WEBPACK FOOTER //\n// /Users/lucast/code/fast-dj/src/app/services/feature-extraction/feature-extraction.service.ts","// The file contents for the current environment will overwrite these during build.\n// The build system defaults to the dev environment which uses `environment.ts`, but if you do\n// `ng build --env=prod` then `environment.prod.ts` will be used instead.\n// The list of which env maps to which file can be found in `.angular-cli.json`.\n\nexport const environment = {\n  production: false\n};\n\n\n\n// WEBPACK FOOTER //\n// /Users/lucast/code/fast-dj/src/environments/environment.ts","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule);\n\n\n\n// WEBPACK FOOTER //\n// /Users/lucast/code/fast-dj/src/main.ts","var map = {\n\t\"./N3Lexer\": \"../../../../n3/lib/N3Lexer.js\",\n\t\"./N3Lexer.js\": \"../../../../n3/lib/N3Lexer.js\",\n\t\"./N3Parser\": \"../../../../n3/lib/N3Parser.js\",\n\t\"./N3Parser.js\": \"../../../../n3/lib/N3Parser.js\",\n\t\"./N3Store\": \"../../../../n3/lib/N3Store.js\",\n\t\"./N3Store.js\": \"../../../../n3/lib/N3Store.js\",\n\t\"./N3StreamParser\": \"../../../../n3/lib/N3StreamParser.js\",\n\t\"./N3StreamParser.js\": \"../../../../n3/lib/N3StreamParser.js\",\n\t\"./N3StreamWriter\": \"../../../../n3/lib/N3StreamWriter.js\",\n\t\"./N3StreamWriter.js\": \"../../../../n3/lib/N3StreamWriter.js\",\n\t\"./N3Util\": \"../../../../n3/lib/N3Util.js\",\n\t\"./N3Util.js\": \"../../../../n3/lib/N3Util.js\",\n\t\"./N3Writer\": \"../../../../n3/lib/N3Writer.js\",\n\t\"./N3Writer.js\": \"../../../../n3/lib/N3Writer.js\"\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"../../../../n3/lib recursive ^\\\\.\\\\/N3.*$\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// /Users/lucast/code/fast-dj/node_modules/n3/lib ^\\.\\/N3.*$\n// module id = ../../../../n3/lib recursive ^\\.\\/N3.*$\n// module chunks = main","/* (ignored) */\n\n\n//////////////////\n// WEBPACK FOOTER\n// util (ignored)\n// module id = 1\n// module chunks = main","/* (ignored) */\n\n\n//////////////////\n// WEBPACK FOOTER\n// vertx (ignored)\n// module id = 2\n// module chunks = main"],"sourceRoot":"webpack:///"}